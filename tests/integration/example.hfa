a_i = A_IJK.getRoot()
b_k = B_KL.getRoot()
t1_i = T1_IJ.getRoot()
for i, (t1_j, a_j) in t1_i << a_i:
    for j, (t1_ref, a_k) in t1_j << a_j:
        for k, (a_val, b_l) in (a_k & b_k):
            for l, b_val in b_l:
                t1_ref += a_val * b_val
c_i = C_IJ.getRoot()
d_i = D_I.getRoot()
t1_i = T1_IJ.getRoot()
for i, (d_ref, (mask, c_j, t1_j)) in d_i << (c_i | t1_i):
    for j, (mask, c_val, t1_val) in (c_j | t1_j):
        d_ref += c_val + t1_val